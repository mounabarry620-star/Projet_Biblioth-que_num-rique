# ==============================================================================
# FICHIER : Makefile
# PROJET  : Gestion de Biblioth√®que Num√©rique
# AUTEUR  : Barry Mamadou Bailo
# DATE    : Janvier 2026
# ==============================================================================

# --- 1. CONFIGURATION DU PROJET ---

# Nom de l'ex√©cutable final
TARGET = app

# Compilateur et options
# -Wall -Wextra : Active tous les avertissements (bonnes pratiques)
# -std=c++17    : Utilise le standard C++17 moderne
# -Iinclude     : Indique au compilateur o√π trouver les fichiers .hpp
CXX = g++
CXXFLAGS = -Wall -Wextra -std=c++17 -Iinclude

# Structure des dossiers
SRCDIR = src
OBJDIR = build
TESTDIR = tests

# --- 2. D√âTECTION AUTOMATIQUE DES FICHIERS ---

# Liste tous les fichiers .cpp pr√©sents dans le dossier src/
SOURCES = $(wildcard $(SRCDIR)/*.cpp)

# D√©duit la liste des fichiers objets .o correspondants dans le dossier build/
# (Transforme src/xxx.cpp en build/xxx.o)
OBJECTS = $(patsubst $(SRCDIR)/%.cpp, $(OBJDIR)/%.o, $(SOURCES))

# --- 3. R√àGLES DE COMPILATION ---

# R√®gle par d√©faut (lanc√©e par la commande "make")
all: $(TARGET)

# √âdition de liens (Linking) : Cr√©e l'ex√©cutable √† partir des objets
# $@ repr√©sente la cible (TARGET) et $^ repr√©sente les d√©pendances (OBJECTS)
$(TARGET): $(OBJECTS)
	@echo "üî® Cr√©ation de l'ex√©cutable $(TARGET)..."
	$(CXX) $(CXXFLAGS) -o $@ $^
	@echo "‚úÖ Compilation termin√©e avec succ√®s ! Lancez avec : ./$(TARGET)"

# Compilation s√©par√©e : Cr√©e un fichier .o pour chaque fichier .cpp
# $< repr√©sente le fichier source (.cpp)
$(OBJDIR)/%.o: $(SRCDIR)/%.cpp
	@# Cr√©e le dossier build s'il n'existe pas
	@mkdir -p $(OBJDIR)
	$(CXX) $(CXXFLAGS) -c $< -o $@

# --- 4. TESTS ET NETTOYAGE ---

# R√®gle pour lancer les tests automatis√©s (n√©cessite l'ex√©cutable)
test: $(TARGET)
	@echo "üß™ Lancement du sc√©nario de test automatique..."
	@# Rend le script ex√©cutable (au cas o√π)
	@chmod +x $(TESTDIR)/test.exp
	@# Ex√©cute le script Expect
	@$(TESTDIR)/test.exp

# Nettoyage complet pour rendre un dossier propre (Consigne du prof)
# Supprime l'ex√©cutable, les objets de compilation, et les fichiers g√©n√©r√©s par l'app
clean:
	@echo "üßπ Nettoyage complet des fichiers..."
	rm -rf $(OBJDIR)
	rm -f $(TARGET)
	rm -f library.db
	rm -f app.conf
	rm -f catalogue.html
	rm -f $(TESTDIR)/livres-lot-2.csv
	@echo "‚ú® Dossier propre (Pr√™t pour l'archivage)."

# .PHONY indique que ces r√®gles ne correspondent pas √† des fichiers r√©els
.PHONY: all clean test